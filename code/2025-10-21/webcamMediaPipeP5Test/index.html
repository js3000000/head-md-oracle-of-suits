<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>p5 + hand‑pose detection</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>

  <!-- TensorFlow.js dépendances -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>

  <!-- hand‐pose detection -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>

  <!-- MediaPipe Hands runtime -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>
  <script>
    let video;
    let detector;
    let hands = [];

    async function setupDetector() {
      const model = handPoseDetection.SupportedModels.MediaPipeHands;
      const detectorConfig = {
        runtime: 'mediapipe',
        solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/hands',
        modelType: 'lite',
        maxHands: 1
      };
      detector = await handPoseDetection.createDetector(model, detectorConfig);
      console.log("Détecteur prêt");
    }

    function setup() {
      createCanvas(640, 480);
      video = createCapture(VIDEO);
      video.size(width, height);
      video.hide();

      setupDetector();
    }

    async function detectHands() {
      if (!detector) return;
      hands = await detector.estimateHands(video.elt);
    }

    function drawKeypoints(hand) {
      for (const kp of hand.keypoints) {
        fill(0, 255, 0);
        noStroke();
        circle(kp.x, kp.y, 8);
      }
    }

    function draw() {
      background(0);
      image(video, 0, 0, width, height);

      
    // Vérifie que la vidéo est prête AVANT de lancer la détection
    if (video.elt.readyState === 4 && video.elt.videoWidth > 0) {
      detectHands();
    }

      for (const hand of hands) {
        drawKeypoints(hand);
      }

      fill(255);
      textSize(24);
      text("Hello, monde + détection de mains", 10, height - 20);
    }
  </script>
</body>
</html>
